(()=>{var e={};e.id=6562,e.ids=[6562],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},43331:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},46022:(e,i,r)=>{"use strict";r.d(i,{Au:()=>p,FZ:()=>u,Si:()=>m,X5:()=>s,Zq:()=>d,_A:()=>l,nu:()=>o,zK:()=>a});var t=r(66146),n=r(96330);let s=t.z.object({email:t.z.string().email("Invalid email address"),password:t.z.string().min(6,"Password must be at least 6 characters")}),a=t.z.object({email:t.z.string().email("Invalid email address"),password:t.z.string().min(6,"Password must be at least 6 characters"),firstName:t.z.string().min(1,"First name is required"),lastName:t.z.string().min(1,"Last name is required"),phone:t.z.string().optional()}),o=t.z.object({name:t.z.string().min(1,"Venue name is required"),description:t.z.string().optional(),address:t.z.string().min(1,"Address is required"),city:t.z.string().min(1,"City is required"),postcode:t.z.string().min(1,"Postcode is required"),phone:t.z.string().min(1,"Phone is required"),email:t.z.string().email("Invalid email address"),website:t.z.string().url().optional().or(t.z.literal("")),cuisine:t.z.string().optional(),venueType:t.z.nativeEnum(n.VenueType),capacity:t.z.number().min(1,"Capacity must be at least 1")}),u=t.z.object({venueId:t.z.string().min(1,"Venue is required"),serviceType:t.z.nativeEnum(n.ServiceType),date:t.z.string().min(1,"Date is required"),time:t.z.string().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format"),partySize:t.z.number().min(1,"Party size must be at least 1"),customerName:t.z.string().min(1,"Customer name is required"),customerEmail:t.z.string().email("Invalid email address"),customerPhone:t.z.string().min(1,"Phone number is required"),specialRequests:t.z.string().optional(),tableId:t.z.string().optional()}),l=t.z.object({name:t.z.string().min(1,"Table name is required"),capacity:t.z.number().min(1,"Capacity must be at least 1"),description:t.z.string().optional()});t.z.object({name:t.z.string().min(1,"Event name is required"),description:t.z.string().optional(),date:t.z.string().min(1,"Date is required"),startTime:t.z.string().min(1,"Start time is required"),endTime:t.z.string().min(1,"End time is required"),capacity:t.z.number().min(1,"Capacity must be at least 1"),price:t.z.number().min(0,"Price must be positive").optional()});let d=t.z.object({dayOfWeek:t.z.number().min(0).max(6),openTime:t.z.string().min(1,"Open time is required"),closeTime:t.z.string().min(1,"Close time is required"),isOpen:t.z.boolean()}),c=t.z.object({dayOfWeek:t.z.number().min(0).max(6),openTime:t.z.string().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format"),closeTime:t.z.string().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format"),name:t.z.string().optional(),isActive:t.z.boolean().default(!0)}),m=t.z.object({openingHours:t.z.array(c)}),p=t.z.object({name:t.z.string().min(1,"Widget name is required"),settings:t.z.object({theme:t.z.string().optional(),primaryColor:t.z.string().optional(),showLogo:t.z.boolean().optional(),allowedServices:t.z.array(t.z.nativeEnum(n.ServiceType)).optional()}).optional()})},55511:e=>{"use strict";e.exports=require("crypto")},61712:(e,i,r)=>{"use strict";r.r(i),r.d(i,{patchFetch:()=>y,routeModule:()=>z,serverHooks:()=>f,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>v});var t={};r.r(t),r.d(t,{GET:()=>m,POST:()=>p,dynamic:()=>c});var n=r(54899),s=r(85420),a=r(22403),o=r(44917),u=r(62686),l=r(62258),d=r(46022);let c="force-dynamic";async function m(e,{params:i}){try{let e=await (0,l.oC)();if(!await u.z.venue.findUnique({where:{id:i.id,ownerId:e.id}}))return o.NextResponse.json({error:"Venue not found or access denied"},{status:404});let r=await u.z.venueAvailability.findMany({where:{venueId:i.id},orderBy:{dayOfWeek:"asc"}});return o.NextResponse.json({availability:r})}catch(e){return console.error("Get venue availability error:",e),o.NextResponse.json({error:"Failed to fetch venue availability"},{status:500})}}async function p(e,{params:i}){try{let r=await (0,l.oC)(),t=await e.json(),n=d.Zq.parse(t);if(!await u.z.venue.findUnique({where:{id:i.id,ownerId:r.id}}))return o.NextResponse.json({error:"Venue not found or access denied"},{status:404});let s=await u.z.venueAvailability.upsert({where:{venueId_dayOfWeek:{venueId:i.id,dayOfWeek:n.dayOfWeek}},update:{openTime:n.openTime,closeTime:n.closeTime,startTime:n.openTime,endTime:n.closeTime},create:{venueId:i.id,dayOfWeek:n.dayOfWeek,openTime:n.openTime,closeTime:n.closeTime,startTime:n.openTime,endTime:n.closeTime}});return o.NextResponse.json({availability:s})}catch(e){return console.error("Create venue availability error:",e),o.NextResponse.json({error:"Failed to create venue availability"},{status:500})}}let z=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/venues/[id]/availability/route",pathname:"/api/venues/[id]/availability",filename:"route",bundlePath:"app/api/venues/[id]/availability/route"},resolvedPagePath:"/home/ubuntu/sully-booking-system-production/app/app/api/venues/[id]/availability/route.ts",nextConfigOutput:"",userland:t}),{workAsyncStorage:g,workUnitAsyncStorage:v,serverHooks:f}=z;function y(){return(0,a.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:v})}},62258:(e,i,r)=>{"use strict";r.d(i,{BE:()=>c,Er:()=>d,Ht:()=>p,jw:()=>m,l4:()=>g,oC:()=>z});var t=r(29657),n=r.n(t),s=r(3197),a=r.n(s),o=r(24883),u=r(62686);let l=process.env.JWT_SECRET||"sully-booking-system-secret-key";async function d(e){return n().hash(e,12)}async function c(e,i){return n().compare(e,i)}async function m(e){var i;let r=(i={userId:e},a().sign(i,l,{expiresIn:"7d"})),t=new Date;return t.setDate(t.getDate()+7),await u.z.userSession.create({data:{userId:e,token:r,expiresAt:t}}),r}async function p(){console.log("\uD83D\uDD35 [AUTH-LIB] Getting session");try{let e=(0,o.UL)(),i=e.get("auth-token")?.value;if(console.log("\uD83D\uDD35 [AUTH-LIB] Token from cookies:",i?`Token found (${i.substring(0,20)}...)`:"No token found"),!i)return console.log("\uD83D\uDD35 [AUTH-LIB] No auth token found in cookies"),null;console.log("\uD83D\uDD35 [AUTH-LIB] Looking up session in database");let r=await u.z.userSession.findUnique({where:{token:i},include:{user:!0}});if(!r)return console.log("\uD83D\uDD34 [AUTH-LIB] No session found in database for token"),null;if(console.log("\uD83D\uDD35 [AUTH-LIB] Session found, checking expiration"),r.expiresAt<new Date)return console.log("\uD83D\uDD34 [AUTH-LIB] Session expired, deleting"),await u.z.userSession.delete({where:{id:r.id}}),null;return console.log("\uD83D\uDFE2 [AUTH-LIB] Valid session found for user:",r.user.email),{id:r.user.id,email:r.user.email,firstName:r.user.firstName,lastName:r.user.lastName,role:r.user.role,isActive:r.user.isActive}}catch(e){return console.error("\uD83D\uDD34 [AUTH-LIB] Session error:",e),console.error("\uD83D\uDD34 [AUTH-LIB] Error stack:",e?.stack),null}}async function z(e){let i=await p();if(!i)throw Error("Authentication required");if(!i.isActive)throw Error("Account is inactive");if(e&&!e.includes(i.role))throw Error("Insufficient permissions");return i}async function g(e){try{let i=e.cookies.get("auth-token")?.value;if(!i)return null;let r=await u.z.userSession.findUnique({where:{token:i},include:{user:!0}});if(!r)return null;if(r.expiresAt<new Date)return await u.z.userSession.delete({where:{id:r.id}}),null;if(!r.user.isActive)return null;return{id:r.user.id,email:r.user.email,firstName:r.user.firstName,lastName:r.user.lastName,role:r.user.role,isActive:r.user.isActive}}catch(e){return console.error("Error getting user from token:",e),null}}},62686:(e,i,r)=>{"use strict";r.d(i,{z:()=>n});var t=r(96330);let n=globalThis.prisma??new t.PrismaClient},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},67307:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},96330:e=>{"use strict";e.exports=require("@prisma/client")}};var i=require("../../../../../webpack-runtime.js");i.C(e);var r=e=>i(i.s=e),t=i.X(0,[4055,534,6823,6146],()=>r(61712));module.exports=t})();