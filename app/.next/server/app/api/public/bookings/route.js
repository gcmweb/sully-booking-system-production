"use strict";(()=>{var e={};e.id=7098,e.ids=[7098],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14750:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>N,patchFetch:()=>w,requestAsyncStorage:()=>y,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>k});var i={};o.r(i),o.d(i,{POST:()=>b,dynamic:()=>v});var a=o(49303),r=o(88716),s=o(60670),n=o(87070),u=o(9487),c=o(30971),p=o(4589),l=o(86287),d=o(76876),m=o(53524);let v="force-dynamic";async function b(e){try{let t=await e.json(),o=c.Yy.parse(t),i=await u._.venue.findUnique({where:{id:o.venueId,isActive:!0}});if(!i)return n.NextResponse.json({error:"Venue not found or not available for bookings"},{status:404});if(!(await (0,l.XA)(o.venueId)).canCreateBooking)return n.NextResponse.json({error:"This venue has reached its booking limit. Please contact the venue directly."},{status:403});let a=new Date(o.date),r=await (0,p.gR)(o.venueId,a,o.time,o.partySize,o.serviceType,o.tableId);if(!r.available)return n.NextResponse.json({error:r.reason},{status:409});let[s,v]=o.time.split(":").map(Number),b=new Date(a);b.setHours(s,v,0,0);let g=new Date(b);g.setHours(b.getHours()+1);let y=i.pricePerHour||50,k=await u._.booking.create({data:{venueId:o.venueId,customerName:o.customerName,customerEmail:o.customerEmail,customerPhone:o.customerPhone,startTime:b,endTime:g,totalHours:1,pricePerHour:y,totalAmount:1*y,partySize:o.partySize,serviceType:o.serviceType,date:a,time:o.time,tableId:o.tableId,notes:o.specialRequests,status:m.BookingStatus.PENDING,source:m.BookingSource.DIRECT},include:{venue:{select:{id:!0,name:!0,address:!0,city:!0,phone:!0,email:!0}},table:{select:{id:!0,name:!0}}}});return await (0,l.GC)(o.venueId),await (0,d.jJ)(o.customerEmail,{bookingId:k.id,customerName:o.customerName,venueName:i.name,venueAddress:`${i.address}, ${i.city}`,venuePhone:i.phone,date:a.toDateString(),time:o.time,partySize:o.partySize,serviceType:o.serviceType,specialRequests:o.specialRequests}),await (0,d.sc)(i.ownerId,m.NotificationType.BOOKING_CONFIRMATION,"New Booking Received",`New ${o.serviceType.toLowerCase()} booking from ${o.customerName} for ${a.toDateString()} at ${o.time}`,{bookingId:k.id}),n.NextResponse.json({booking:{id:k.id,status:k.status,date:k.date,time:k.time,partySize:k.partySize,serviceType:k.serviceType,venue:k.venue,table:k.table},message:"Booking created successfully! You will receive a confirmation email shortly."})}catch(e){return console.error("Create public booking error:",e),n.NextResponse.json({error:"Failed to create booking. Please try again."},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/public/bookings/route",pathname:"/api/public/bookings",filename:"route",bundlePath:"app/api/public/bookings/route"},resolvedPagePath:"/home/ubuntu/sully-booking-system-v2/app/app/api/public/bookings/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:y,staticGenerationAsyncStorage:k,serverHooks:h}=g,N="/api/public/bookings/route";function w(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:k})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),i=t.X(0,[9276,5972,7410,7752],()=>o(14750));module.exports=i})();