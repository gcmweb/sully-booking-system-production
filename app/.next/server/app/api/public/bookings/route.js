"use strict";(()=>{var e={};e.id=5412,e.ids=[5412],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},58937:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>y,serverHooks:()=>w,workAsyncStorage:()=>b,workUnitAsyncStorage:()=>k});var o={};r.r(o),r.d(o,{POST:()=>g,dynamic:()=>v});var a=r(54899),s=r(85420),i=r(22403),n=r(44917),u=r(62686),p=r(46022),c=r(69609),d=r(44069),l=r(36242),m=r(96330);let v="force-dynamic";async function g(e){try{let t=await e.json(),r=p.FZ.parse(t),o=await u.z.venue.findUnique({where:{id:r.venueId,isActive:!0}});if(!o)return n.NextResponse.json({error:"Venue not found or not available for bookings"},{status:404});if(!(await (0,d.k)(r.venueId)).canCreateBooking)return n.NextResponse.json({error:"This venue has reached its booking limit. Please contact the venue directly."},{status:403});let a=new Date(r.date),s=await (0,c.q0)(r.venueId,a,r.time,r.partySize,r.serviceType,r.tableId);if(!s.available)return n.NextResponse.json({error:s.reason},{status:409});let[i,v]=r.time.split(":").map(Number),g=new Date(a);g.setHours(i,v,0,0);let y=new Date(g);y.setHours(g.getHours()+1);let b=o.pricePerHour||50,k=await u.z.booking.create({data:{venueId:r.venueId,customerName:r.customerName,customerEmail:r.customerEmail,customerPhone:r.customerPhone,startTime:g,endTime:y,totalHours:1,pricePerHour:b,totalAmount:+b,partySize:r.partySize,serviceType:r.serviceType,date:a,time:r.time,tableId:r.tableId,notes:r.specialRequests,status:m.BookingStatus.PENDING,source:m.BookingSource.DIRECT},include:{venue:{select:{id:!0,name:!0,address:!0,city:!0,phone:!0,email:!0}},table:{select:{id:!0,name:!0}}}});return await (0,d.gJ)(r.venueId),await (0,l.LO)(r.customerEmail,{bookingId:k.id,customerName:r.customerName,venueName:o.name,venueAddress:`${o.address}, ${o.city}`,venuePhone:o.phone??"",date:a.toDateString(),time:r.time,partySize:r.partySize,serviceType:r.serviceType,specialRequests:r.specialRequests}),await (0,l.UI)(o.ownerId,m.NotificationType.BOOKING_CONFIRMATION,"New Booking Received",`New ${r.serviceType.toLowerCase()} booking from ${r.customerName} for ${a.toDateString()} at ${r.time}`,{bookingId:k.id}),n.NextResponse.json({booking:{id:k.id,status:k.status,date:k.date,time:k.time,partySize:k.partySize,serviceType:k.serviceType,venue:k.venue,table:k.table},message:"Booking created successfully! You will receive a confirmation email shortly."})}catch(e){return console.error("Create public booking error:",e),n.NextResponse.json({error:"Failed to create booking. Please try again."},{status:500})}}let y=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/public/bookings/route",pathname:"/api/public/bookings",filename:"route",bundlePath:"app/api/public/bookings/route"},resolvedPagePath:"/home/ubuntu/sully-booking-system-production/app/app/api/public/bookings/route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:b,workUnitAsyncStorage:k,serverHooks:w}=y;function x(){return(0,i.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:k})}},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},96330:e=>{e.exports=require("@prisma/client")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[4055,534,6146,9295],()=>r(58937));module.exports=o})();