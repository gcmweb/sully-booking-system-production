(()=>{var e={};e.id=9517,e.ids=[9517],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},43331:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},67307:()=>{},77157:(e,t,o)=>{"use strict";o.r(t),o.d(t,{patchFetch:()=>p,routeModule:()=>l,serverHooks:()=>m,workAsyncStorage:()=>b,workUnitAsyncStorage:()=>g});var r={};o.r(r),o.d(r,{GET:()=>c,dynamic:()=>d});var n=o(54899),a=o(85420),i=o(22403),u=o(44917),s=o(96330);!function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}();let d="force-dynamic";async function c(e,{params:t}){try{let o=await Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}())(),r=t.id,{searchParams:n}=new URL(e.url),a=parseInt(n.get("timeRange")||"30"),i=await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).venue.findUnique({where:{id:r},include:{owner:!0}});if(!i)return u.NextResponse.json({error:"Venue not found"},{status:404});if(o.role!==s.Role.SUPER_ADMIN&&i.ownerId!==o.id)return u.NextResponse.json({error:"Access denied"},{status:403});let d=new Date,c=new Date;c.setDate(c.getDate()-a);let l={venueId:r,createdAt:{gte:c,lte:d}},b=await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).booking.count({where:l}),g=await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).payment.aggregate({where:{booking:l,status:"COMPLETED"},_sum:{amount:!0}}),m=Number(g._sum.amount||0),p=await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).booking.aggregate({where:l,_avg:{partySize:!0}}),y=Number(p._avg.partySize||0),O=(await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).booking.findMany({where:l,include:{payments:{where:{status:"COMPLETED"}}},orderBy:{date:"asc"}})).reduce((e,t)=>{let o=(t.date||t.startTime).toISOString().split("T")[0];return e[o]||(e[o]={date:o,bookings:0,revenue:0,totalPartySize:0,count:0}),e[o].bookings+=1,e[o].revenue+=t.payments.reduce((e,t)=>e+Number(t.amount),0),e[o].totalPartySize+=t.partySize||0,e[o].count+=1,e},{}),v=Object.values(O).map(e=>({date:e.date,bookings:e.bookings,revenue:e.revenue,avgPartySize:e.count>0?e.totalPartySize/e.count:0})),w=(await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).booking.groupBy({by:["serviceType"],where:l,_count:{serviceType:!0},_sum:{partySize:!0}})).map(e=>({type:e.serviceType,count:e._count.serviceType,totalGuests:e._sum.partySize||0,percentage:e._count.serviceType/b*100})),k=(await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).booking.findMany({where:l,select:{startTime:!0,partySize:!0}})).reduce((e,t)=>{let o=t.startTime.getHours().toString();return e[o]||(e[o]={hour:`${o}:00`,bookings:0,totalPartySize:0,count:0}),e[o].bookings+=1,e[o].totalPartySize+=t.partySize||0,e[o].count+=1,e},{}),h=Object.values(k).map(e=>({hour:e.hour,bookings:e.bookings,avgPartySize:e.count>0?e.totalPartySize/e.count:0})).sort((e,t)=>t.bookings-e.bookings),_=(await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).booking.groupBy({by:["status"],where:l,_count:{status:!0}})).map(e=>({status:e.status,count:e._count.status,percentage:e._count.status/b*100})),D=(await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).table.findMany({where:{venueId:r},include:{bookings:{where:{createdAt:{gte:c,lte:d}}}}})).map(e=>{let t=e.bookings.length,o=t>0?e.bookings.reduce((e,t)=>e+(t.partySize||0),0)/t:0,r=e.capacity>0?o/e.capacity*100:0;return{tableName:e.name,capacity:e.capacity,bookings:t,avgPartySize:o,utilizationRate:r}}).sort((e,t)=>t.bookings-e.bookings),f=(await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).booking.findMany({where:l,select:{customerEmail:!0,customerName:!0,partySize:!0,createdAt:!0}})).reduce((e,t)=>{let o=t.customerEmail;return e[o]||(e[o]={email:o,name:t.customerName,totalBookings:0,totalGuests:0,lastBooking:t.createdAt}),e[o].totalBookings+=1,e[o].totalGuests+=t.partySize||0,t.createdAt>e[o].lastBooking&&(e[o].lastBooking=t.createdAt),e},{}),N=Object.values(f).filter(e=>e.totalBookings>1).map(e=>({email:e.email,name:e.name,totalBookings:e.totalBookings,totalGuests:e.totalGuests,avgPartySize:e.totalGuests/e.totalBookings,lastBooking:e.lastBooking.toLocaleDateString()})).sort((e,t)=>t.totalBookings-e.totalBookings).slice(0,10),E=new Date;E.setDate(1);let U=new Date(E);U.setMonth(U.getMonth()-1);let T=new Date(E);T.setDate(T.getDate()-1);let M=await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).booking.count({where:{venueId:r,createdAt:{gte:E}}}),S=await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).booking.count({where:{venueId:r,createdAt:{gte:U,lte:T}}}),j=await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).payment.aggregate({where:{booking:{venueId:r,createdAt:{gte:E}},status:"COMPLETED"},_sum:{amount:!0}}),z=await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).payment.aggregate({where:{booking:{venueId:r,createdAt:{gte:U,lte:T}},status:"COMPLETED"},_sum:{amount:!0}}),L=Number(z._sum.amount||0)>0?(Number(j._sum.amount||0)-Number(z._sum.amount||0))/Number(z._sum.amount||0)*100:0,P={currentMonth:{bookings:M,revenue:Number(j._sum.amount||0)},previousMonth:{bookings:S,revenue:Number(z._sum.amount||0)},growth:{bookings:Math.round(S>0?(M-S)/S*100:0),revenue:Math.round(L)}},C=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],x=(await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).booking.findMany({where:l,select:{date:!0,startTime:!0,partySize:!0}})).reduce((e,t)=>{let o=(t.date||t.startTime).getDay();return e[o]||(e[o]={day:C[o],bookings:0,totalPartySize:0,count:0}),e[o].bookings+=1,e[o].totalPartySize+=t.partySize||0,e[o].count+=1,e},{}),F=Object.values(x).map(e=>({day:e.day,bookings:e.bookings,avgPartySize:e.count>0?e.totalPartySize/e.count:0})).sort((e,t)=>t.bookings-e.bookings);return u.NextResponse.json({venue:{id:i.id,name:i.name,venueType:i.venueType},totalBookings:b,totalRevenue:m,averagePartySize:y,bookingTrends:v.map(e=>({date:new Date(e.date).toLocaleDateString(),bookings:e.bookings,revenue:e.revenue,avgPartySize:e.avgPartySize})),serviceTypeBreakdown:w,statusBreakdown:_,peakHours:h,tableUtilization:D,customerInsights:N,busiestDays:F,monthlyComparison:P})}catch(e){return console.error("Venue analytics error:",e),u.NextResponse.json({error:"Failed to fetch venue analytics"},{status:500})}}let l=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/venues/[id]/analytics/route",pathname:"/api/venues/[id]/analytics",filename:"route",bundlePath:"app/api/venues/[id]/analytics/route"},resolvedPagePath:"/home/ubuntu/sully-booking-system-production/app/app/api/venues/[id]/analytics/route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:b,workUnitAsyncStorage:g,serverHooks:m}=l;function p(){return(0,i.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:g})}},96330:e=>{"use strict";e.exports=require("@prisma/client")}};var t=require("../../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[4055,534],()=>o(77157));module.exports=r})();