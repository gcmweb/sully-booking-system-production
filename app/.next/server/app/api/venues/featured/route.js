(()=>{var e={};e.id=2911,e.ids=[2911],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},43331:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},67307:()=>{},73666:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>g,serverHooks:()=>w,workAsyncStorage:()=>v,workUnitAsyncStorage:()=>A});var s={};r.r(s),r.d(s,{GET:()=>f,dynamic:()=>m});var a=r(54899),n=r(85420),i=r(22403),o=r(44917),c=r(96330);class u{formatMessage(e,t,r){let s=new Date().toISOString(),a=r?` | Context: ${JSON.stringify(r)}`:"";return`[${s}] ${e.toUpperCase()}: ${t}${a}`}info(e,t){console.log(this.formatMessage("info",e,t))}error(e,t,r){let s={...r,error:t instanceof Error?{message:t.message,stack:t.stack,name:t.name}:t};console.error(this.formatMessage("error",e,s))}warn(e,t){console.warn(this.formatMessage("warn",e,t))}debug(e,t){}}let d=new u,l=globalThis.prisma??function(){if(d.info("Initializing Prisma client",{nodeEnv:"production",hasDatabaseUrl:!!process.env.DATABASE_URL,databaseUrlLength:process.env.DATABASE_URL?.length||0}),!process.env.DATABASE_URL)throw d.error("DATABASE_URL environment variable is not set"),Error("DATABASE_URL environment variable is required");return new c.PrismaClient({log:["error","warn"],errorFormat:"pretty"})}();async function p(e,t=3,r="database operation"){let s=null;for(let a=1;a<=t;a++)try{d.debug(`Attempting ${r}`,{attempt:a,maxRetries:t});let s=await e();return a>1&&d.info(`${r} succeeded on retry`,{attempt:a}),s}catch(e){if(s=e instanceof Error?e:Error(String(e)),d.warn(`${r} failed on attempt ${a}`,{attempt:a,maxRetries:t,error:s.message}),s.message.includes("authentication failed")||s.message.includes("database")&&s.message.includes("does not exist")||s.message.includes("Environment variable not found"))throw d.error(`${r} failed with non-retryable error`,s),s;if(a<t){let e=1e3*Math.pow(2,a-1);d.debug(`Waiting ${e}ms before retry`),await new Promise(t=>setTimeout(t,e))}}throw d.error(`${r} failed after ${t} attempts`,s),s}process.on("beforeExit",async()=>{d.info("Application shutting down, disconnecting from database..."),await l.$disconnect()}),process.on("SIGINT",async()=>{d.info("Received SIGINT, disconnecting from database..."),await l.$disconnect(),process.exit(0)}),process.on("SIGTERM",async()=>{d.info("Received SIGTERM, disconnecting from database..."),await l.$disconnect(),process.exit(0)});let m="force-dynamic";async function f(){let e=Date.now();try{d.info("Featured venues API called");let t=await p(async()=>await l.venue.findMany({where:{featured:!0,isActive:!0},select:{id:!0,name:!0,slug:!0,description:!0,address:!0,city:!0,postcode:!0,phone:!0,email:!0,website:!0,cuisine:!0,venueType:!0,isActive:!0,featured:!0,capacity:!0,images:{select:{id:!0,url:!0,alt:!0},where:{isActive:!0},orderBy:{displayOrder:"asc"}},owner:{select:{firstName:!0,lastName:!0}}},orderBy:{updatedAt:"desc"},take:3}),3,"fetch featured venues"),r=Date.now()-e;return d.info("Featured venues fetched successfully",{count:t.length,duration:`${r}ms`}),o.NextResponse.json({success:!0,data:t,meta:{count:t.length,duration:r,timestamp:new Date().toISOString()}})}catch(a){let t=Date.now()-e;d.error("Error fetching featured venues",a,{duration:`${t}ms`,endpoint:"/api/venues/featured"});let r="Failed to fetch featured venues",s="INTERNAL_SERVER_ERROR";return a instanceof Error&&(a.message.includes("ENOTFOUND")?(s="DATABASE_CONNECTION_FAILED",r="Unable to connect to database"):a.message.includes("authentication failed")?(s="DATABASE_AUTH_FAILED",r="Database authentication failed"):a.message.includes("timeout")?(s="DATABASE_TIMEOUT",r="Database query timed out"):a.message.includes("Environment variable not found")&&(s="MISSING_DATABASE_URL",r="Database configuration missing")),o.NextResponse.json({success:!1,error:{type:s,message:r,details:void 0},meta:{duration:t,timestamp:new Date().toISOString(),endpoint:"/api/venues/featured"}},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/venues/featured/route",pathname:"/api/venues/featured",filename:"route",bundlePath:"app/api/venues/featured/route"},resolvedPagePath:"/home/ubuntu/sully-booking-system-production/app/app/api/venues/featured/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:v,workUnitAsyncStorage:A,serverHooks:w}=g;function h(){return(0,i.patchFetch)({workAsyncStorage:v,workUnitAsyncStorage:A})}},96330:e=>{"use strict";e.exports=require("@prisma/client")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4055,534],()=>r(73666));module.exports=s})();